angular.module("rzTable",[]),angular.module("rzTable").directive("rzTable",["resizeStorage","$injector","$parse","$timeout",function(t,n,e,o){function r(t){}function i(t,n,e){I=n,O=t.container?$(t.container):$(I).parent(),t.options=e.rzOptions?t.options||{}:{},$(I).addClass(t.options.tableClass||"rz-table"),o(function(){f(I,e,t),l(I,e,t),u(I,e,t),a(I,e,t)})}function s(t,n,e){return function(o,r){e.busy!==!0&&void 0!==r&&r!==o&&(c(t),f(t,n,e))}}function a(t,n,e){e.$watch("profile",s(t,n,e)),e.$watch("mode",s(t,n,e)),e.$watch("busy",s(t,n,e))}function u(t,n,e){e.$watch(function(){return $(t).find("th").length},s(t,n,e))}function l(n,o,r){if(o.rzModel){var i=e(o.rzModel);i.assign(r.$parent,{update:function(){c(n),f(n,o,r)},reset:function(){d(n),this.clearStorageActive(),this.update()},clearStorage:function(){t.clearAll()},clearStorageActive:function(){t.clearCurrent(n,C,T)}})}}function c(t){E=!0,h(t)}function d(t){$(t).outerWidth("100%"),$(t).find("th").width("auto")}function h(t){W.map(function(t){t.remove()}),W=[]}function f(n,e,o){if(!o.busy){R=$(n).find("th"),C=o.mode,S=!angular.isDefined(o.saveTableSizes)||o.saveTableSizes,T=o.profile;var r=y(o,e);r&&(x=new r(n,R,O),S&&(j=t.loadTableSizes(n,o.mode,o.profile)),A=x.handles(R),M=x.ctrlColumns,x.setup(),w(j),A.each(function(t,e){p(o,n,e)}))}}function p(t,n,e){var o=$("<div>",{"class":t.options.handleClass||"rz-handle"});$(e).prepend(o),W.push(o);var r=x.handleMiddleware(o,e);m(t,n,o,r)}function m(t,n,e,o){$(e).mousedown(function(n){E&&(x.onFirstDrag(o,e),x.onTableReady(),E=!1),t.options.onResizeStarted&&t.options.onResizeStarted(o);var r={};x.intervene&&(r=x.intervene.selector(o),r.column=r,r.orgWidth=$(r).width()),n.preventDefault(),$(e).addClass(t.options.handleClassActive||"rz-handle-active");var i=n.clientX,s=$(o).width();D=v(t,o,i,s,r),$(window).mousemove(D),$(window).one("mouseup",b(t,o,e))})}function v(t,n,e,o,r){return function(i){var s=i.clientX,a=s-e,u=x.calculate(o,a);if(!(u<z(n)||x.restrict(u,a))){if(x.intervene){var l=x.intervene.calculator(r.orgWidth,a);if(l<z(r.column))return;if(x.intervene.restrict(l,a))return;$(r.column).width(l)}t.options.onResizeInProgress&&t.options.onResizeInProgress(n,u,a),$(n).width(u)}}}function z(t){return parseInt($(t).css("min-width"))||0}function y(t,e){try{var o=e.rzMode?t.mode:"BasicResizer",r=n.get(o);return r}catch(i){return console.error("The resizer "+t.mode+" was not found"),null}}function b(t,n,e){return function(){$(e).removeClass(t.options.handleClassActive||"rz-handle-active"),D&&$(window).unbind("mousemove",D),t.options.onResizeEnded&&t.options.onResizeEnded(n),x.onEndDrag(),g()}}function g(){S&&(j||(j={}),$(R).each(function(t,n){var e=angular.element(n).scope()||{},o=e.rzCol||$(n).attr("id");o&&(j[o]=x.saveAttr(n))}),t.saveTableSizes(I,C,T,j))}function w(t){t&&($(I).width("auto"),M.each(function(n,e){var o=angular.element(e).scope()||{},r=o.rzCol||$(e).attr("id"),i=t[r];$(e).css({width:i})}),x.onTableReady())}var C,S,T,R=null,M=null,A=null,D=null,W=[],I=null,O=null,x=null,E=!0,j=null;return r.$inject=["$scope","$attrs","$element"],{restrict:"A",link:i,controller:r,scope:{mode:"=rzMode",profile:"=?rzProfile",busy:"=?rzBusy",saveTableSizes:"=?rzSave",options:"=?rzOptions",model:"=rzModel",container:"@rzContainer"}}}]),angular.module("rzTable").directive("rzCol",[function(){function t(t,n,e){t.rzCol=t.$eval(e.rzCol)}return{restrict:"A",priority:650,link:t,require:"^^rzTable",scope:!0}}]),angular.module("rzTable").service("resizeStorage",["$window",function(t){function n(t,n,o){var r=t.attr("id");return r?e+"."+t.attr("id")+"."+n+(o?"."+o:""):void console.error("Table has no id",t)}var e="ngColumnResize";this.loadTableSizes=function(e,o,r){var i=n(e,o,r),s=t.localStorage.getItem(i);return JSON.parse(s)},this.saveTableSizes=function(e,o,r,i){var s=n(e,o,r);if(s){var a=JSON.stringify(i);t.localStorage.setItem(s,a)}},this.clearAll=function(){for(var n=[],o=0;o<t.localStorage.length;++o){var r=localStorage.key(o);r&&r.startsWith(e)&&n.push(r)}n.map(function(n){t.localStorage.removeItem(n)})},this.clearCurrent=function(e,o,r){var i=n(e,o,r);i&&t.localStorage.removeItem(i)}}]),angular.module("rzTable").factory("ResizerModel",[function(){function t(t,n,e){this.table=t,this.columns=n,this.container=e,this.handleColumns=this.handles(),this.ctrlColumns=this.ctrlColumns()}return t.prototype.setup=function(){$(this.container).css({overflowX:"hidden"})},t.prototype.onTableReady=function(){$(this.table).outerWidth("100%")},t.prototype.getMinWidth=function(t){return parseInt($(t).css("min-width"))||0},t.prototype.handles=function(){return this.columns},t.prototype.ctrlColumns=function(){return this.handleColumns},t.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,n){$(n).width($(n).width())})},t.prototype.handleMiddleware=function(t,n){return n},t.prototype.restrict=function(t){return!1},t.prototype.calculate=function(t,n){return t+n},t.prototype.onEndDrag=function(){},t.prototype.saveAttr=function(t){return $(t).outerWidth()},t}]),angular.module("rzTable").factory("BasicResizer",["ResizerModel",function(t){function n(n,i,s){t.call(this,n,i,s),this.ctrlColumns=this.columns,this.intervene={selector:e,calculator:o,restrict:r}}function e(t){return $(t).next()}function o(t,n){return t-n}function r(t){return t<25}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.table).css({width:"100%"})},n.prototype.handles=function(){return $(this.columns).not(":last")},n.prototype.onFirstDrag=function(){this.onEndDrag()},n.prototype.onEndDrag=function(){var t=$(this.table).outerWidth(),n=[];$(this.columns).each(function(e,o){var r=$(o).outerWidth(),i=r/t*100+"%";n.push(function(){$(o).css({width:i})})}),n.map(function(t){t()})},n.prototype.saveAttr=function(t){return $(t)[0].style.width},n}]),angular.module("rzTable").factory("FixedResizer",["ResizerModel",function(t){function n(n,e,o){t.call(this,n,e,o),this.fixedColumn=$(n).find("th").first(),this.bound=!1}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.table).css({width:"100%"}),$(this.columns).first().css({width:"auto"})},n.prototype.handles=function(){return $(this.columns).not(":last")},n.prototype.ctrlColumns=function(){return $(this.columns).not(":first")},n.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,n){$(n).width($(n).width())})},n.prototype.handleMiddleware=function(t,n){return $(n).next()},n.prototype.restrict=function(t,n){return this.bound&&this.bound<n?(this.bound=!1,!1):!!(this.bound&&this.bound>n)||(this.fixedColumn.width()<=this.getMinWidth(this.fixedColumn)?(this.bound=n,$(this.fixedColumn).width(this.minWidth),!0):void 0)},n.prototype.onEndDrag=function(){this.bound=!1},n.prototype.calculate=function(t,n){return t-n},n}]),angular.module("rzTable").factory("OverflowResizer",["ResizerModel",function(t){function n(n,e,o){t.call(this,n,e,o)}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.container).css({overflow:"auto"})},n.prototype.onTableReady=function(){$(this.table).width(1)},n}]);